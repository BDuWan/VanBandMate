<div class="dialog-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                <div class="dialog-inner mh-490">
                    <div class="contact-hd dialog-hd">
                        <h5 class="tag-a">Student Information</h5>
                        <br>
                        <table class="table table-striped">
                            <tbody>
                            <tr>
                                <th class="sorting_1">First Name</th>
                                <td class="pdf-30">{{.User.FirstName}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Last Name</th>
                                <td class="pdf-30">{{.User.LastName}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Email</th>
                                <td class="pdf-30">{{.User.Email}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Phone Number</th>
                                <td class="pdf-30">{{.User.PhoneNumber}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Address</th>
                                <td class="pdf-30">{{.User.Address}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-8 col-md-8 col-sm-8 col-xs-12">
                <div class="dialog-inner sm-res-mg-t-30 mh-490">
                    <div class="data-table-list" style="padding: 0;">
                        <div class="basic-tb-hd row">
                            <div class="col-lg-10 col-sm-12">
                                <h5 class="tag-a">Courses</h5>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <div class="dataTables_wrapper">
                                <table id="table-courses" class="table table-striped dataTable c-f-dataTable">
                                    <thead>
                                    <tr>
                                        <th class="t-id-9">STT</th>
                                        <th>Name</th>
                                        <th>Study Program</th>
                                        <th>Instructor</th>
                                        <th>Description</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="dialog-inner mg-t-30 mh-250">
                    <div class="data-table-list" style="padding: 0;">

                        <div class="basic-tb-hd row">
                            <div class="col-lg-10 col-sm-12">
                                <h5 class="tag-a">Assignments</h5>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <div class="dataTables_wrapper">
                                <table id="table-assignments" class="table table-striped dataTable c-f-dataTable">
                                    <thead>
                                    <tr>
                                        <th class="t-id">STT</th>
                                        <th>Name</th>
                                        <th>Course</th>
                                        <th style="width: 12%;">Start Time</th>
                                        <th style="width: 12%;">End Time</th>
                                        <th>Action</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        var UserID = {{.User.UserID}};
        $.fn.dataTable.ext.errMode = 'none';
        var table_courses = $('#table-courses').DataTable({
            "processing": true,
            "serverSide": true,
            ajax: {
                url: '/managements/students/api/courses/'+UserID,
                type: 'POST',
                "contentType": "application/json",
                "data": function (d) {
                    return JSON.stringify(d);
                }

            },
            columns: [
                {
                    "data": null,
                    "searchable": false,
                    "orderable": false,
                    "render": function (data, type, full, meta) {
                        return table_courses.rows().count() > 0 ?
                            meta.row + meta.settings._iDisplayStart + 1 : 0;
                    }
                },
                {data: 'Course.name'},
                {data: 'Course.StudyProgram.title'},
                {data: 'User.last_name'},
                {data: 'Course.description'},
            ],

            "drawCallback": function (settings) {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;
                api.column(0, {page: 'current'}).nodes().each(function (cell, i) {
                    cell.innerHTML = startIndex + i + 1;
                });
            },
            "ordering": true,
            lengthMenu: [[5, 10], ['5', '10']],
            // language: {
            //     lengthMenu: "{{.Lag.Show}}" + '_MENU_' + "{{.Lag.Index}}",
            //     infoFiltered: "({{.Lag.InTotal}} _MAX_ {{.Lag.Index}})",
            //     info: "{{.Lag.Show}} _START_ {{.Lag.Arrive}} _END_ {{.Lag.BelongTo}} _TOTAL_ {{.Lag.Index}}",
            //     infoEmpty: "{{.Lag.Show}} 0 {{.Lag.Arrive}} 0 {{.Lag.BelongTo}} 0 {{.Lag.Index}}",
            //     search: "{{.Lag.Search}}",
            //     paginate: {
            //         next: '{{.Lag.Next}}',
            //         previous: '{{.Lag.Previous}}'
            //     },
            // }
        });

        var table_assignments = $('#table-assignments').DataTable({
            "processing": true,
            "serverSide": true,
            ajax: {
                url: '/managements/students/api/assignments/'+UserID,
                type: 'POST',
                "contentType": "application/json",
                "data": function (d) {
                    return JSON.stringify(d);
                }

            },
            columns: [
                {
                    "data": null,
                    "searchable": false,
                    "orderable": false,
                    "render": function (data, type, full, meta) {
                        return table_assignments.rows().count() > 0 ?
                            meta.row + meta.settings._iDisplayStart + 1 : 0;
                    }
                },
                {
                    data: 'Assignment.name',
                    render:function (data){
                        return lenString(data,50)
                    },
                    createdCell: function(td, cellData) {
                        td.title = cellData;

                    },
                },
                {
                    data: 'Assignment.Course.name',
                    render:function (data){
                        return lenString(data,50)
                    },
                    createdCell: function(td, cellData) {
                        td.title = cellData;

                    },
                },
                {
                    data: 'Assignment.start_time',
                    render:function (data){
                        return formatTime(data);
                    },
                },
                {
                    data: 'Assignment.end_time',
                    render:function (data){
                        return formatTime(data);
                    },
                },
                {
                    data: 'assignment_id',
                    render: function (data, type, full, row) {
                        if (type === 'display') {

                            return `<div class="row" style="margin:0;">
                                                  <div class="col-sm-12 t-center">
                                                    <a href="/managements/mng-courses/assignment/user/${data}/${full.user_id}">
                                                      <i class="fas fa-info-circle cl-ed" aria-hidden="true" title="Information"></i>
                                                    </a>
                                                  </div>
                                                </div>`;


                        }
                        return data;
                    }
                }
            ],

            "drawCallback": function (settings) {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;
                api.column(0, {page: 'current'}).nodes().each(function (cell, i) {
                    cell.innerHTML = startIndex + i + 1;
                });
            },
            "ordering": true,
            lengthMenu: [[5, 10], ['5', '10']],
        });

        function formatTime(dateString) {
            const date = new Date(dateString); // Assuming the dateString is in a format recognized by Date.parse()

            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
            const year = String(date.getFullYear()); // Get last 2 digits of year

            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        function lenString(text, length) {
            let count = text.length;
            let stringText = text;
            if (count > length) {
                stringText = "..." + text.substring(count - length + 4, count);
            }
            return stringText
        }
    });

</script>