<div class="data-table-area">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                <div class="dialog-inner mh-410">
                    <div class="contact-hd dialog-hd">
                        <h5 class="tag-a" id="lb-sale-business">Sale Information</h5>
                        <br>
                        <table class="table table-striped">
                            <tbody>
                            <tr id="first-name" style="display: none;">
                                <th class="sorting_1">First Name</th>
                                <td class="pdf-30">{{.User.FirstName}}</td>
                            </tr>
                            <tr id="last-name" style="display: none;">
                                <th class="sorting_1">Last Name</th>
                                <td class="pdf-30">{{.User.LastName}}</td>
                            </tr>
                            <tr id="name-business" style="display: none;">
                                <th class="sorting_1">Name Business</th>
                                <td class="pdf-30">{{.User.NameBusiness}}</td>
                            </tr>
                            <tr id="full-name-representative" style="display: none;">
                                <th class="sorting_1">Full Name Representative</th>
                                <td class="pdf-30">{{.User.FullNameRepresentative}}</td>
                            </tr>

                            <tr>
                                <th class="sorting_1">Email</th>
                                <td class="pdf-30">{{.User.Email}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Phone Number</th>
                                <td class="pdf-30">{{.User.PhoneNumber}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Address</th>
                                <td class="pdf-30">{{.User.Address}}</td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                <div class="dialog-inner mh-410">
                    <div class="contact-hd dialog-hd">
                        <h5 class="tag-a" id="lb-commission">Commission</h5>
                        <br>
                        <table class="table table-striped">
                            <tbody>
                            <tr id="commission-total">
                                <th class="sorting_1">Commission Total</th>
                                <td class="pdf-30">{{.CommissionUser.CommissionTotal}}</td>
                            </tr>
                            <tr id="commission-paid">
                                <th class="sorting_1">Commission Paid</th>
                                <td class="pdf-30">{{.CommissionUser.CommissionPaid}}</td>
                            </tr>
                            <tr id="commission-debt">
                                <th class="sorting_1">Commission Debt</th>
                                <td class="pdf-30">{{.CommissionUser.CommissionDebt}}</td>
                            </tr>                    
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-4 col-md-4 col-sm-4 col-xs-12">
                <div class="dialog-inner mh-410">
                    <div class="contact-hd dialog-hd">
                        <h5 class="tag-a" id="lb-commission">Current Period</h5>
                        <br>
                        {{if IsTimeAfterNow .CommissionUser.Period.PeriodEnd}}
                        <table class="table table-striped">
                            <tbody>
                            <tr>
                                <th class="sorting_1">Number Student</th>
                                <td class="pdf-30">{{.CommissionUser.Period.NumberStudent}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Student Paid</th>
                                <td class="pdf-30">{{.CommissionUser.Period.StudentPaid}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Commission</th>
                                <td class="pdf-30">{{.CommissionUser.Period.Commission}}</td>
                            </tr>     
                            <tr>
                                <th class="sorting_1">Period Start Date</th>
                                <td class="pdf-30">{{.CommissionUser.Period.PeriodStart | FormatDate}}</td>
                            </tr>
                            <tr>
                                <th class="sorting_1">Period End Date</th>
                                <td class="pdf-30">{{.CommissionUser.Period.PeriodEnd | FormatDate}}</td>
                            </tr>    
                                    
                            </tbody>
                        </table>
                        {{else}}
                        <p>There is no new period yet</p>
                        {{end}}
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="dialog-inner mg-t-30 mh-250">
                    <div class="data-table-list" style="padding: 0;">
                        <div class="basic-tb-hd row">
                            <div class="col-lg-10 col-sm-12">
                                <h5 class="tag-a">Students</h5>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <div class="dataTables_wrapper">
                                <table id="table-students" class="table table-striped dataTable c-f-dataTable w-tb">
                                    <thead>
                                    <tr>
                                        <th class="t-id">STT</th>
                                        <th>Email</th>
                                        <th>First Name</th>
                                        <th>Last Name</th>
                                        <th>Phone Number</th>
                                        <th>Address</th>
                                        <th>Verify</th>
                                        <th>Paid</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="dialog-inner mg-t-30 mh-250">
                    <div class="data-table-list" style="padding: 0;">
                        <div class="basic-tb-hd row">
                            <div class="col-lg-10 col-sm-12">
                                <h5 class="tag-a">Periods History</h5>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <div class="dataTables_wrapper">
                                <table id="table-periods" class="table table-striped dataTable c-f-dataTable w-tb">
                                    <thead>
                                    <tr>
                                        <th class="t-id">No.</th>
                                        <th>Number Students</th>
                                        <th>Students Paid</th>
                                        <th>Commission</th>
                                        <th>Period Start Date</th>
                                        <th>Period End Date</th>                            
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

         <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="dialog-inner mg-t-30 mh-250">
                    <div class="data-table-list" style="padding: 0;">
                        <div class="basic-tb-hd row">
                            <div class="col-lg-10 col-sm-12">
                                <h5 class="tag-a">Pay History</h5>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <div class="dataTables_wrapper">
                                <button class="btn btn-green btn-reco-mg btn-button-mg waves-effect" style="float: right;">
                                    <a href="/managements/sale-business/payments/create/{{.CommissionUser.User.UserID}}" class="btn-green">
                                        <span><i class="fas fa-plus"></i></span> Pay
                                    </a>
                                </button>
                                <br>
                                <br>
                                <table id="table-history-pay" class="table table-striped dataTable c-f-dataTable w-tb">
                                    <thead>
                                        
                                    <tr>
                                        <th class="t-id">STT</th>
                                        <th>Commission Total</th>
                                        <th>Commission Paid</th>
                                        <th>Commission Debt</th>
                                        <th>Description</th>
                                        <th>Time</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <div class="dialog-inner mg-t-30 mh-250">
                    <div class="data-table-list" style="padding: 0;">
                        <div class="basic-tb-hd row">
                            <div class="col-lg-10 col-sm-12">
                                <h5 class="tag-a">Gain Commission History</h5>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <div class="dataTables_wrapper">
                                <table id="table-history-gain" class="table table-striped dataTable c-f-dataTable w-tb">
                                    <thead>                                       
                                    <tr>
                                        <th class="t-id">STT</th>
                                        <th>Commission Total</th>
                                        <th>Commission Paid</th>
                                        <th>Commission Debt</th>
                                        <th>Description</th>
                                        <th>Time</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
    </div>
</div>
<script>
    $(document).ready(function () {

        var UserID = {{.User.UserID}};

        var idTypeUser = parseInt({{.User.TypeUserID}}, 10);

        if (idTypeUser == 2){
            $("#lb-sale-business").text("Sale Director Information");
            $("#first-name").show();
            $("#last-name").show();
        }else{
            $("#lb-sale-business").text("Business Information");
            $("#name-business").show();
            $("#full-name-representative").show();
        }
        $.fn.dataTable.ext.errMode = 'none';
        var table_instructors = $('#table-instructors').DataTable({
            "processing": true,
            "serverSide": true,
            ajax: {
                url: '/managements/sale-business/api/instructors/' + UserID,
                type: 'POST',
                "contentType": "application/json",
                "data": function (d) {
                    return JSON.stringify(d);
                }

            },
            columns: [
                {
                    "data": null,
                    "searchable": false,
                    "orderable": false,
                    "render": function (data, type, full, meta) {
                        return table_instructors.rows().count() > 0 ?
                            meta.row + meta.settings._iDisplayStart + 1 : 0;
                    }
                },
                {data: 'email'},
                {data: 'first_name'},
                {data: 'last_name'},
                {data:'phone_number'},
                {data:'address'},
                {
                    data: 'verify',
                    render:function (data){
                        return StatusVerify(data);
                    }
                },
            ],

            "drawCallback": function (settings) {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;
                api.column(0, {page: 'current'}).nodes().each(function (cell, i) {
                    cell.innerHTML = startIndex + i + 1;
                });
            },
            "ordering": true,
            lengthMenu: [[25, 50, 100], ['25', '50', '100']],
            // language: {
            //     lengthMenu: "{{.Lag.Show}}" + '_MENU_' + "{{.Lag.Index}}",
            //     infoFiltered: "({{.Lag.InTotal}} _MAX_ {{.Lag.Index}})",
            //     info: "{{.Lag.Show}} _START_ {{.Lag.Arrive}} _END_ {{.Lag.BelongTo}} _TOTAL_ {{.Lag.Index}}",
            //     infoEmpty: "{{.Lag.Show}} 0 {{.Lag.Arrive}} 0 {{.Lag.BelongTo}} 0 {{.Lag.Index}}",
            //     search: "{{.Lag.Search}}",
            //     paginate: {
            //         next: '{{.Lag.Next}}',
            //         previous: '{{.Lag.Previous}}'
            //     },
            // }
        });

        var table_students = $('#table-students').DataTable({
            ajax: {
                url: '/managements/sale-business/api/students/' + UserID,
                type: 'POST',
                "contentType": "application/json",
                "data": function (d) {
                    return JSON.stringify(d);
                }

            },
            columns: [
                {
                    "data": null,
                    "searchable": false,
                    "orderable": false,
                    "render": function (data, type, full, meta) {
                        return table_students.rows().count() > 0 ?
                            meta.row + meta.settings._iDisplayStart + 1 : 0;
                    }
                },
                {data: 'email'},
                {data: 'first_name'},
                {data: 'last_name'},
                {data:'phone_number'},
                {data:'address'},
                {
                    data: 'verify',
                    render:function (data){
                        return StatusVerify(data);
                    }
                },
                {
                    data: 'paid',
                    render: function (data, type, full, meta) {
                        if (data == 0) {
                            return 'Unpaid';
                        } else {
                            return 'Has Paid';
                        }
                    }
                },
            ],

            "paging": true, 
            "searching": true,
            "ordering": true,
            "order": [],
            "drawCallback": function (settings) {
                var api = this.api();
                api.column(0, {
                    order: 'applied'
                }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            }
        });

        var table_periods = $('#table-periods').DataTable({
            ajax: {
                url: '/managements/sale-business/api/periods/' + UserID,
                type: 'POST',
                "contentType": "application/json",
                "data": function (d) {
                    return JSON.stringify(d);
                }

            },
            columns: [
                {
                    "data": null,
                    "searchable": false,
                    "orderable": false,
                    "render": function (data, type, full, meta) {
                        return table_periods.rows().count() > 0 ?
                            meta.row + meta.settings._iDisplayStart + 1 : 0;
                    }
                },
                {data: 'number_student'},
                {data: 'student_paid'},
                {data: 'commission'},
                {
                    data: 'period_start',
                    render: function (data, type, full, meta) {
                        return moment(data).format('YYYY-MM-DD');
                    }
                },
                {
                    data: 'period_end',
                    render: function (data, type, full, meta) {
                        return moment(data).format('YYYY-MM-DD');
                    }
                }              
            ],
            "paging": true, 
            "searching": true,
            "ordering": true,
            "order": [],
            "drawCallback": function (settings) {
                var api = this.api();
                api.column(0, {
                    order: 'applied'
                }).nodes().each(function (cell, i) {
                    cell.innerHTML = i + 1;
                });
            }
        });

        var table_history_pay = $('#table-history-pay').DataTable({
            "processing": true,
            "serverSide": true,
            ajax: {
                url: '/managements/sale-business/api/history-pay/' + UserID,
                type: 'POST',
                "contentType": "application/json",
                "data": function (d) {
                    return JSON.stringify(d);
                }

            },
            columns: [
                {
                    "data": null,
                    "searchable": false,
                    "orderable": false,
                    "render": function (data, type, full, meta) {
                        return table_history_pay.rows().count() > 0 ?
                            meta.row + meta.settings._iDisplayStart + 1 : 0;
                    }
                },
                {data: 'commission_total'},
                {data: 'commission_paid'},
                {data: 'commission_debt'},
                {data: 'description'},               
                {
                    data: 'created_at',
                    render:function (data){
                        return formatTime(data);
                    },
                },
            ],

            "drawCallback": function (settings) {
                var api = this.api();
                var startIndex = api.context[0]._iDisplayStart;
                api.column(0, {page: 'current'}).nodes().each(function (cell, i) {
                    cell.innerHTML = startIndex + i + 1;
                });
            },
            "ordering": true,
            lengthMenu: [[25, 50, 100], ['25', '50', '100']],
            // language: {
            //     lengthMenu: "{{.Lag.Show}}" + '_MENU_' + "{{.Lag.Index}}",
            //     infoFiltered: "({{.Lag.InTotal}} _MAX_ {{.Lag.Index}})",
            //     info: "{{.Lag.Show}} _START_ {{.Lag.Arrive}} _END_ {{.Lag.BelongTo}} _TOTAL_ {{.Lag.Index}}",
            //     infoEmpty: "{{.Lag.Show}} 0 {{.Lag.Arrive}} 0 {{.Lag.BelongTo}} 0 {{.Lag.Index}}",
            //     search: "{{.Lag.Search}}",
            //     paginate: {
            //         next: '{{.Lag.Next}}',
            //         previous: '{{.Lag.Previous}}'
            //     },
            // }
        });

        // var table_history_gain = $('#table-history-gain').DataTable({
        //     "processing": true,
        //     "serverSide": true,
        //     ajax: {
        //         url: '/managements/sale-business/api/history-gain/' + UserID,
        //         type: 'POST',
        //         "contentType": "application/json",
        //         "data": function (d) {
        //             return JSON.stringify(d);
        //         }

        //     },
        //     columns: [
        //         {
        //             "data": null,
        //             "searchable": false,
        //             "orderable": false,
        //             "render": function (data, type, full, meta) {
        //                 return table_history_gain.rows().count() > 0 ?
        //                     meta.row + meta.settings._iDisplayStart + 1 : 0;
        //             }
        //         },
        //         {data: 'commission_total'},
        //         {data: 'commission_paid'},
        //         {data: 'commission_debt'},
        //         {data: 'description'},               
        //         {
        //             data: 'created_at',
        //             render:function (data){
        //                 return formatTime(data);
        //             },
        //         },
        //     ],

        //     "drawCallback": function (settings) {
        //         var api = this.api();
        //         var startIndex = api.context[0]._iDisplayStart;
        //         api.column(0, {page: 'current'}).nodes().each(function (cell, i) {
        //             cell.innerHTML = startIndex + i + 1;
        //         });
        //     },
        //     "ordering": true,
        //     lengthMenu: [[25, 50, 100], ['25', '50', '100']],
        //     // language: {
        //     //     lengthMenu: "{{.Lag.Show}}" + '_MENU_' + "{{.Lag.Index}}",
        //     //     infoFiltered: "({{.Lag.InTotal}} _MAX_ {{.Lag.Index}})",
        //     //     info: "{{.Lag.Show}} _START_ {{.Lag.Arrive}} _END_ {{.Lag.BelongTo}} _TOTAL_ {{.Lag.Index}}",
        //     //     infoEmpty: "{{.Lag.Show}} 0 {{.Lag.Arrive}} 0 {{.Lag.BelongTo}} 0 {{.Lag.Index}}",
        //     //     search: "{{.Lag.Search}}",
        //     //     paginate: {
        //     //         next: '{{.Lag.Next}}',
        //     //         previous: '{{.Lag.Previous}}'
        //     //     },
        //     // }
        // });

        function formatTime(dateString) {
            const date = new Date(dateString); // Assuming the dateString is in a format recognized by Date.parse()

            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0'); // Months are 0-based
            const year = String(date.getFullYear()); // Get last 2 digits of year

            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            const seconds = String(date.getSeconds()).padStart(2, '0');

            return `${year}-${month}-${day} ${hours}:${minutes}:${seconds}`;
        }

        function StatusVerify(verify){
            if(verify === true){
                return "Verified";
            }
            return "Not verified";
        }
    });
</script>